상속을 사용하는 것보다 합성을 사용하는 것이 클래스의 높은 결합도를 낮출 수 있다.

> **화이트 박스 재사용**
서브 클래싱에 의한 재사용을 의미
상속을 받으면 부모 클래스의 내부가 자식 클래스에 공개 되기 때문에 이때, 부모 클래스는 화이트박스인 셈이다.

**블랙박스 재사용**
합성은 객체들의 공통된 인터페이스를 명확히 정의해야한다.
이때, 객체 내부는 공개되지 않고 인터페이스를 통해서 재사용되는 것
> 

---

### 01 상속을 합성으로 변경하기

코드 재사용을 위해 상속을 남발할 경우 발생할 문제 3가지를 10장에서 살펴보았다.

- 불필요한 인터페이스 상속 문제
- 메서드 오버라이딩의 오작용 문제
- 부모 클래스와 자식 클래스의 동시 수정 문제

합성을 사용하면 위 3가지 문제를 해결할 수 있다.

- **불필요한 인터페이스 상속 문제**
    
    이는 상속 관계를 제거하고 인스턴스 변수로 포함시키면 합성 관계로 변경할 수 있다.
    
- **메서드 오버라이딩의 오작용 문제**
    
    Set 인터페이스를 실체화하면서 내부에 HashSet 인터페이스 합성하면 HashSet에 대한 구현 결합도는 제거되면서도 퍼블릭 인터페이스는 그대로 유지할 수 있다.
    
- **부모 클래스와 자식 클래스의 동시 수정 문제**
    
    Playlist를 합성으로 수정하더라도 Playlist와 PersonalPlayList를 함께 수정 해야한다.
    
    대부분의 경우 구현에 대한 결합보다 인터페이스에 대한 결합이 더 좋다.
    
    > **몽키 패치 (Monekey Patch)**
    : 현재 실행중인 환경에만 영향을 미치도록 지역적으로 코드를 수정하거나 확장하는 것을 가리킨다.
    > 

합성을 사용하면 안정성과 유연성이라는 장점을 제공한다.

인터페이스에 의존하면 유연한 설계가 가능해진다.

### 02 상속으로 인한 조합의 폭발적인 증가

상속으로 인해 결합도가 높아져 하나의 기능 수정시 많은 클래스들을 수정해야 상황이 발생할 수 있다.

일반적으로 다음 두 가지 문제점이 발생한다.

- 하나의 기능을 추가하거나 수정하기 위해 불필요하게 많은 수의 클래스를 추가하거나 수정해야한다.
- 단일 상속만 지원하는 언어에서는 상속으로 인해 오히려 중복 코드의 양이 늘어날 수 있다.

부모 클래스에 추상메서드를 추가하면 자식 클래스는 모두 이 메서드를 오버라이딩 해야한다. 만일 자식 클래스의 수가 많다면 꽤 번거로워진다.

기본 구현을 제공한다면 유연성은 유지하면서 중복성을 제거할 수 있게 된다.

> **훅 메서드(hook method)**
: 추상 메서드와 동일하게 자식 클래스에서 오버라이딩(overriding)할 의도로 메서드를 추가했지만 편의를 위해 기본 구현을 제공하는 메서드
> 

자바를 비롯한 대부분의 객체 지향 언어는 상속을 하나만 허용하기 때문에 상속으로 인한 중복 코드 문제를 해결하는 것은 쉽지 않다.

상속을 이용해 부가 정책을 자유롭게 순서대로 조합할 수 있는 방법은 조합가능한 모든 조합을 자식 클래스로 만드는 것이다.

하지만 이 경우 새로운 정책을 추가하는 것은 쉽지 않도록 설계가 된다.

→ 새로운 정책 추가시 조합 가능한 모든 조합을 또 자식 클래스로 생성해야한다.

이처럼 상속 남용을 하게 된다면 클래스 폭발 문제(class explosion) 또는 조합 폭발 문제(combinational explosion)가 발생하게 된다.

이는 상속의 한계점인 부모와 자식 사이에 강결합이 생겨 발생하는 것이 원인이다.

컴파일 타임에 결정되는 것도 원인이 된다.

### 03 합성 관계로 변환하기

상속은 컴파일 타임에 클래스 간의 관계를 확정짓는다.

합성을 사용하게 되면 런타임에 동적으로 변경 가능하며, 실행 시점에 정책들의 관계를 유연하게 변경할 수 있다.

컴파일 의존성에 속박되지 않고 다양한 방식의 런타임 의존성을 구현할 수 있다는 것이 합성의 제공하는 가장 커다란 장점인 것이다.

합성하는 객체의 타입을 인터페이스나 추상 클래스로 선언하고 의존성 주입을 사용해 런타임에 필요한 객체를 설정할 수 있도록 구현하는 것이 일반적이다.

합성을 이용하면 객체를 조합하고 사용하는 방식이 훨씬 예측 가능하고 일관성 있다는 것을 알 수 있다. 새로운 정책을 추가할 때도 하나의 클래스만 추가하면 된다.

상속은 자식 클래스와 부모 클래스가 강하게 결합되기 때문에 우아한 해결책이 아니다. 

상속은 또 구현 상속과 인터페이스 상속으로 나뉘는 데 13장에서 현재까지 상속은 구현 상속이란 점.

### 04 믹스인

믹스인(mixin)은 객체를 생성할 때 코드의 일부를 클래스 안에 섞어 넣어 사용하는 재사용 기법을 의미한다.

믹스인과 상속은 다르다.

상속이 부모 클래스와 자식 클래스 사이의 관계를 고정시키는데 비해 믹스인은 유연하게 관계를 재구성할 수 있다.

합성과 믹스인은 유사한 면이 있는데, 합성은 독립적으로 작성된 객체들을 런타임 시점에 조합해서 더 큰 기능을 만들어내고, 믹스인은 독립적으로 작성된 트레이트와 클래스를 코드 컴파일 시점에 조합해 더 큰 기능을 만들어 낼 수 있다.
